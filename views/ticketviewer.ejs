<!DOCTYPE html>
<html lang = "en">
  <head>
    <title>Ticketer - View Tickets</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src = "https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <link rel="stylesheet" href = "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>
    <script src = "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link href="public/css/navbar.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <%- include includes/navbar.ejs %>

    <div class="container">
        <div class="jumbotron">
          <div class="row">
            <div class="col-sm-3">
              <% if(currentPage == "ticketViewerAdmin") { %>
                <h2>Active Tickets</h2>
              <% } else { %>
                <h2>Archived Tickets</h2>
              <% } %>
            </div>
            <div class="col-sm-6">
            </div>
            <div class="col-sm-3">
              <% if(currentPage == "ticketViewer") { %>
                <a href="/archivedTickets"><button type="button" class="btn btn-block btn-info">Archived Tickets</button></a>
              <% } %>
            </div>
          </div>

          <div class="row">
            <div class="col-sm-12">
              <h4>

                <table class = "table table-striped table-bordered table-hover" id = "ticketsTable" style = "width:100%">
                  <% if(tickets.length > 0) { %>
                    <thead class = "thead-default">
                      <tr>
                        <th style="cursor:pointer" onclick="sortTable(0)">Title</th>
                        <th style="cursor:pointer" onclick="sortTable(1)">Room</th>
                        <th style="cursor:pointer" onclick="sortTable(2)">Description</th>
                        <th style="cursor:pointer" onclick="sortTable(3)">User</th>
                        <th style="cursor:pointer" onclick="sortTable(4)">Status</th>
                        <th style="cursor:pointer" onclick="sortTable(5)">Assigned Technician</th>
                      </tr>
                    </thead>
                  <% } else {%>
                      <% if (currentPage != "archivedTickets") { %>
                        <h4>There are no active tickets.</h4>
                      <% } else { %>
                        <h4>There are no archived tickets.</h4>
                      <% } %>
                  <% } %>
                  <% for (var i=0; i < tickets.length; i++) {%>
                      <tr>
                        <td><%=tickets[i].name %></td>
                        <td><%=tickets[i].room %></td>
                        <td><%=tickets[i].desc %></td>
                        <td><%=tickets[i].author %></td>
                        <td><%=tickets[i].status %></td>
                        <td><%=tickets[i].assigned %></td>
                      </tr>
                  <% } %>
                </table>
              </h4>
            </div>
          </div>
        </div>
      </div>
    <script>
        function sortTable(n) {
          var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
          table = document.getElementById("ticketsTable");
          switching = true;
          //Set the sorting direction to ascending:
          dir = "asc";
          /*Make a loop that will continue until
          no switching has been done:*/
          while (switching) {
            //start by saying: no switching is done:
            switching = false;
            rows = table.getElementsByTagName("TR");
            /*Loop through all table rows (except the
            first, which contains table headers):*/
            for (i = 1; i < (rows.length - 1); i++) {
              //start by saying there should be no switching:
              shouldSwitch = false;
              /*Get the two elements you want to compare,
              one from current row and one from the next:*/
              x = rows[i].getElementsByTagName("TD")[n];
              y = rows[i + 1].getElementsByTagName("TD")[n];
              /*check if the two rows should switch place,
              based on the direction, asc or desc:*/
              if (dir == "asc") {
                if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                  //if so, mark as a switch and break the loop:
                  shouldSwitch= true;
                  break;
                }
              } else if (dir == "desc") {
                if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                  //if so, mark as a switch and break the loop:
                  shouldSwitch= true;
                  break;
                }
              }
            }
            if (shouldSwitch) {
              /*If a switch has been marked, make the switch
              and mark that a switch has been done:*/
              rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
              switching = true;
              //Each time a switch is done, increase this count by 1:
              switchcount ++;
            } else {
              /*If no switching has been done AND the direction is "asc",
              set the direction to "desc" and run the while loop again.*/
              if (switchcount == 0 && dir == "asc") {
                dir = "desc";
                switching = true;
              }
            }
          }
        }
    </script>
  </body>
</html>
